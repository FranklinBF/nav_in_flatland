<launch>

  <arg name="global_frame_id" default="map"/>
  <arg name="scan_topic" default="scan"/> <!-- default laser topic in flatland -->
   <!--<arg name="odom_topic" default="odom"/>
  <arg name="odom_frame_id" default="odom"/>
  <arg name="base_frame_id" default="base"/>  -->


  <!--  ******************** flatland********************  -->
  <!--
  You can override these default values:
    roslaunch flatland_Server server.launch world_path:="/some/world.yaml" initial_rate:="30.0"
  -->
  <arg name="world_path"   default="$(find flatland_models)/maps/map.world.yaml"/>
  <arg name="update_rate" default="10000.0"/>
  <arg name="step_size" default="0.005"/>
  <arg name="show_viz" default="true"/>
  <arg name="viz_pub_rate" default="30.0"/>
  <arg name="use_rviz" default="true"/>  

  <env name="ROSCONSOLE_FORMAT" value="[${severity} ${time} ${logger}]: ${message}" />

  <param name="use_sim_time" value="true"/>  

  <!-- launch flatland server -->
  <node name="flatland_server" pkg="flatland_server" type="flatland_server" output="screen">  
    <param name="world_path" value="$(arg world_path)" />
    <param name="update_rate" value="$(arg update_rate)" />
    <param name="step_size" value="$(arg step_size)" />
    <param name="show_viz" value="$(arg show_viz)" />
    <param name="viz_pub_rate" value="$(arg viz_pub_rate)" />
  </node>


  <!--  ***************** Robot Model *****************  -->
  <!-- Name of the map to use (without path nor extension) and initial position -->
  <arg name="initial_pose_x" default="0.0"/>
  <arg name="initial_pose_y" default="0.0"/>
  <arg name="initial_pose_a" default="0.0"/>
  
  
  <!--<node name="spawn_model" pkg="rosservice" type="rosservice"-->
  <!--  args="call --wait /spawn_model &quot;{-->
  <!--    yaml_path: '$(find flatland_models)/robot/myrobot.model.yaml',-->
  <!--    name: 'myrobot0',-->
  <!--    ns: '',-->
  <!--    pose: {x: $(arg initial_pose_x), y: $(arg initial_pose_y), theta: $(arg initial_pose_a)}}&quot;"-->
  <!--  />-->
  

  <!-- ****** Maps ***** -->
  <node name="map_server" pkg="map_server" type="map_server" args="$(find flatland_models)/maps/map.yaml">
   <param name="frame_id" value="$(arg global_frame_id)"/>
  </node>

<!--  ************** Navigation  ***************  -->

 <!-- move_base -->
<include file="$(find flatland_navigation)/launch/move_base.launch"/>

<!-- AMCL -->
<include file="$(find flatland_navigation)/launch/amcl.launch" />

<!--  ************** flatland viz  ***************  -->
<group if="$(arg show_viz)">
  <node name="flatland_viz" pkg="flatland_viz" type="flatland_viz" output="screen" required="true" unless="$(arg use_rviz)"/>
</group>

<!--  ************** rviz  ***************  -->
<group if="$(arg use_rviz)">
  <node name="flatland_rviz" pkg="rviz" type="rviz" output="screen" args="-d $(find flatland_navigation)/rviz/nav.rviz"/>
</group>


</launch>
